import os
from PIL import Image
from torch.utils.data import Dataset
from torchvision import transforms
from torchvision.models import resnet50, ResNet50_Weights


class CatsDogsCarsImageDataset(Dataset):
    def __init__(self, root_dir, split="train"):
        self.root_dir = os.path.join(root_dir, split)
        self.images_dir = os.path.join(self.root_dir, "images")
        self.labels_path = os.path.join(self.root_dir, "labels.txt")

        with open(self.labels_path, "r") as f:
            lines = f.readlines()

        self.samples = [line.strip().split() for line in lines]
        self.transform = ResNet50_Weights.DEFAULT.transforms()

    def __len__(self):
        return len(self.samples)

    def __getitem__(self, idx):
        image_name, label = self.samples[idx]
        image_path = os.path.join(self.images_dir, image_name)
        image = Image.open(image_path).convert("RGB")
        image = self.transform(image)
        return image, int(label)
